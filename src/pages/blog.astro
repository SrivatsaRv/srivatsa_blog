---
import Layout from '../layouts/Layout.astro';
import FilterHub from '../components/FilterHub';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const allTags = [...new Set(posts.flatMap(post => post.data.tags))].sort();
const allYears = [...new Set(posts.map(post => post.data.pubDate.getFullYear()))].sort((a,b) => b-a);
---

<Layout title="Operational Logs">
    <div class="mb-12 pt-8 border-b border-hud-border pb-6">
        <h1 class="text-2xl md:text-3xl font-black font-mono uppercase tracking-tighter text-hud-text mb-2">
            Mission
        </h1>
    </div>

    <!-- Controls & Feed -->
    <FilterHub client:load posts={posts.map(p => ({
        ...p.data,
        slug: p.slug,
        classification: p.data.classification || 'UNCLASSIFIED'
    }))} />
</Layout>
