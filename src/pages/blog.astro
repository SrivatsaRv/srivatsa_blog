---
import Layout from '../layouts/Layout.astro';
import PostCard from '../components/PostCard.astro';
import FilterControl from '../components/FilterControl.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const allTags = [...new Set(posts.flatMap(post => post.data.tags))].sort();
const allYears = [...new Set(posts.map(post => post.data.pubDate.getFullYear()))].sort((a,b) => b-a);
---

<Layout title="Operational Logs">
    <div class="mb-12 pt-8 border-b border-hud-border pb-6">
        <h1 class="text-2xl md:text-3xl font-black font-mono uppercase tracking-tighter text-hud-text mb-2">
            Mission
        </h1>
    </div>

    <!-- Controls -->
    <FilterControl tags={allTags} years={allYears} />

    <!-- Feed -->
    <section id="feed" class="space-y-6 min-h-[50vh]">
        {posts.map((post) => (
            <div 
                class="post-card-container transition-all duration-300 ease-in-out"
                data-year={post.data.pubDate.getFullYear()}
                data-month={post.data.pubDate.getMonth()}
                data-tags={post.data.tags.join(',')}
            >
                <PostCard
                    title={post.data.title}
                    description={post.data.description}
                    pubDate={post.data.pubDate}
                    tags={post.data.tags}
                    classification={post.data.classification || 'UNCLASSIFIED'}
                    url={`/blog/${post.slug}/`}
                />
            </div>
        ))}
        
        {posts.length === 0 && (
            <div class="text-center py-20 border border-dashed border-hud-border text-hud-muted">
                NO_LOGS_FOUND_IN_ARCHIVE
            </div>
        )}
    </section>
</Layout>
